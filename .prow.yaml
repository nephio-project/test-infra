presubmits:
  - name: pre-submit-test-infra-validate-local
    annotations:
    labels:
    run_if_changed: '^prow/config/((plugins|config).yaml|jobs/)'
    skip_report: false
    decorate: true
    cluster: default
    spec:
      containers:
        - image: "gcr.io/k8s-prow/checkconfig:v20221208-8898931a7f"
          command:
            - "checkconfig"
          args:
            - "--plugin-config=prow/config/plugins.yaml"
            - "--config-path=prow/config/config.yaml"
postsubmits:
  - name: build-push-gotests-image
    cluster: default
    run_if_changed: "^VERSION$"
    branches:
    - main
    annotations:
      description: Build and Push GO Tests Image
    decorate: true
    decoration_config:
      censor_secrets: true
    max_concurrency: 1
    spec:
      containers:
      - name: kaniko
        image: gcr.io/kaniko-project/executor:debug
        command:
        - "/bin/sh"
        - "-c"
        - |
          executor --context=${PWD}/images/gotests \
            --dockerfile=Dockerfile --destination=nephio/gotests:${BUILD_ID}
        volumeMounts:
          - name: kaniko-secret
            mountPath: /kaniko/.docker/
        resources:
          requests:
            cpu: 2
            memory: 2Gi
      volumes:
        - name: kaniko-secret
          secret:
            secretName: regcred
            items:
              - key: .dockerconfigjson
                path: config.json
